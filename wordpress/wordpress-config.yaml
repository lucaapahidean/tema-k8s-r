apiVersion: v1
kind: ConfigMap
metadata:
  name: wordpress-config
data:
  wait.sh: |
    #!/bin/bash
    set -e
    
    echo "üöÄ Simple wait for database..."
    
    # Extract host and port
    DB_HOST=$(echo "$WORDPRESS_DB_HOST" | cut -d: -f1)
    DB_PORT=$(echo "$WORDPRESS_DB_HOST" | cut -d: -f2)
    
    echo "‚è≥ Waiting for $DB_HOST:$DB_PORT to be ready..."
    
    # Simple port check using bash built-ins
    for i in $(seq 1 60); do
        if timeout 1 bash -c "</dev/tcp/$DB_HOST/$DB_PORT" 2>/dev/null; then
            echo "‚úÖ Database port $DB_HOST:$DB_PORT is open!"
            
            # Additional wait for MySQL to be fully ready
            echo "‚è≥ Waiting extra 10 seconds for MySQL initialization..."
            sleep 10
            echo "‚úÖ Ready to start WordPress!"
            exit 0
        fi
        echo "Attempt $i/60 - waiting for $DB_HOST:$DB_PORT..."
        sleep 2
    done
    
    echo "‚ùå Timeout waiting for database"
    exit 1